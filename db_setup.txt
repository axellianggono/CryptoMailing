-- Buat database
CREATE DATABASE IF NOT EXISTS `kriptowijaya`;
USE `kriptowijaya`;

-- Tabel users
CREATE TABLE IF NOT EXISTS `users` (
  `id` int NOT NULL AUTO_INCREMENT,
  `username` varchar(255) NOT NULL,
  `password` varchar(255) NOT NULL,
  `public_key` text NOT NULL,
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`)
);

-- Tabel mails
CREATE TABLE IF NOT EXISTS `mails` (
  `id` int NOT NULL AUTO_INCREMENT,
  `sender_id` int NOT NULL DEFAULT '0',
  `receiver_id` int NOT NULL DEFAULT '0',
  `message` text NOT NULL,
  `session_key` text NOT NULL,
  `signature` text NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_sender_mail` (`sender_id`),
  KEY `fk_receiver_mail` (`receiver_id`),
  CONSTRAINT `fk_receiver_mail` FOREIGN KEY (`receiver_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `fk_sender_mail` FOREIGN KEY (`sender_id`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
);
